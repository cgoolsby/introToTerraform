Stage 5: Secure version of stage 3
